<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>Houston Oil Airs — Immersive 3D Diorama</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
html, body { height: 100%; }
body { margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: radial-gradient(1200px 700px at 70% -10%, #0c2440 0%, #061424 35%, #030b16 70%, #01060e 100%) fixed; color: #e6eef7; overflow: hidden; }
canvas { display: block; }

/* UI Shell */
#hud { position: fixed; inset: 0 0 auto 0; padding: 16px 18px; display: flex; align-items: center; gap: 12px; backdrop-filter: blur(6px); background: linear-gradient(180deg, rgba(4,12,24,.55), rgba(4,12,24,.15) 55%, rgba(4,12,24,0) 100%); z-index: 10; border-bottom: 1px solid rgba(255,255,255,.06); }
#brand { display: flex; align-items: center; gap: 12px; }
#dot { width: 10px; height: 10px; border-radius: 50%; background: #1df2ff; box-shadow: 0 0 16px #1df2ff; }
#title { font-weight: 800; letter-spacing: .3px; }
#subtitle { font-size: 12px; opacity: .8; }

#nav { margin-left: auto; display: flex; gap: 10px; }
.nav-btn { appearance: none; border: 1px solid rgba(255,255,255,.12); background: rgba(6,20,36,.55); color: #e6eef7; padding: 8px 12px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: .2s ease; box-shadow: 0 6px 18px rgba(0,0,0,.25) inset, 0 0 0 0 rgba(29,242,255,.35); }
.nav-btn:hover { transform: translateY(-1px); border-color: rgba(29,242,255,.55); box-shadow: 0 0 0 2px rgba(29,242,255,.25); }

#legend { position: fixed; left: 16px; bottom: 16px; display: grid; grid-template-columns: auto 1fr; gap: 8px 10px; padding: 12px 14px; background: rgba(6,20,36,.55); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; z-index: 9; font-size: 12px; }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; box-shadow: 0 0 10px currentColor; }
.legend-city { color: #7aa7ff; }
.legend-energy { color: #ffd166; }
.legend-research { color: #1df2ff; }
.legend-policy { color: #b28dff; }

#panel { position: fixed; right: 16px; top: 78px; width: min(420px, 38vw); max-height: 72vh; overflow: auto; padding: 14px 16px; background: rgba(5,14,28,.6); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; z-index: 11; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
#panel h2 { margin: 6px 0 8px; font-size: 18px; }
#panel h3 { margin: 12px 0 6px; font-size: 14px; opacity: .9; letter-spacing: .3px; text-transform: uppercase; }
#panel p, #panel li { color: #c9d7ea; line-height: 1.55; }
#panel .muted { opacity: .8; font-size: 12px; }
#panel .badge { display: inline-block; padding: 4px 8px; border-radius: 999px; background: rgba(29,242,255,.15); border: 1px solid rgba(29,242,255,.35); color: #9ff9ff; font-size: 11px; margin-right: 6px; }
#panel .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 10px 0 4px; }
.metric { background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.08); border-radius: 10px; padding: 10px; text-align: center; }
.metric .k { font-size: 18px; font-weight: 800; color: #fff; }
.metric .l { font-size: 11px; opacity: .75; }

#minihelp { position: fixed; right: 16px; bottom: 16px; z-index: 9; font-size: 12px; opacity: .8; padding: 8px 10px; background: rgba(6,20,36,.55); border: 1px solid rgba(255,255,255,.08); border-radius: 10px; }

.toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: -60px; padding: 10px 14px; background: rgba(20,220,160,.1); border: 1px solid rgba(20,220,160,.35); color: #b6ffe8; border-radius: 10px; z-index: 12; transition: .35s ease; }
.toast.show { bottom: 16px; }

/* Tooltip */
#tooltip { position: fixed; pointer-events: none; transform: translate(-50%, -120%); padding: 8px 10px; background: rgba(6,20,36,.9); border: 1px solid rgba(255,255,255,.08); border-radius: 10px; font-size: 12px; z-index: 13; min-width: 160px; display: none; }
#tooltip .t1 { font-weight: 800; }
#tooltip .t2 { opacity: .8; }

/* Mobile */
@media (max-width: 820px) {
	#panel { position: fixed; left: 16px; right: 16px; width: auto; bottom: 72px; top: auto; max-height: 40vh; }
	#hud { padding: 10px 12px; }
	#legend { display: none; }
}
</style>
</head>
<body>
<div id="hud">
	<div id="brand">
		<div id="dot"></div>
		<div>
			<div id="title">Houston Oil Airs</div>
			<div id="subtitle">Immersive Research City • Realtime • Secure • High-Performance</div>
		</div>
	</div>
	<div id="nav">
		<button class="nav-btn" onclick="location.href='./docs/graph-viewer.html'">Project Graph</button>
		<button class="nav-btn" onclick="location.href='./README.html'">Readme</button>
	</div>
</div>
<div id="legend">
	<div class="legend-dot legend-city"></div><div>City & Districts</div>
	<div class="legend-dot legend-energy"></div><div>Energy & Infrastructure</div>
	<div class="legend-dot legend-research"></div><div>Research & Analytics</div>
	<div class="legend-dot legend-policy"></div><div>Policy & Community</div>
</div>
<div id="panel"></div>
<div id="minihelp">WASD/Drag to look • Click POIs • 1-6 to jump • F for fullscreen</div>
<div id="tooltip"><div class="t1" id="tt1"></div><div class="t2" id="tt2"></div></div>
<div class="toast" id="toast">Tip: Press 1-6 to fly to key districts</div>

<!-- Three.js & GSAP CDNs -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
<script src="https://unpkg.com/gsap@3.12.5/dist/gsap.min.js"></script>

<script>
const STATE = {
	stops: [],
	poiMeshes: [],
	clock: new THREE.Clock(),
	raycaster: new THREE.Raycaster(),
	mouse: new THREE.Vector2(),
	composer: null,
	bloomPass: null,
	camera: null,
	renderer: null,
	scene: null,
	controls: null,
	panelEl: null,
	navEl: null,
	tooltipEl: null,
	toastEl: null
};

// Repo-derived content
const CONTENT = {
	brand: {
		vision: "Advancing responsible AI through cutting-edge research visualization",
		features: [
			"Immersive 3D Visualizations",
			"Real-time Analytics",
			"Interactive Network Analysis",
			"High Performance (C++/Java/Node)",
			"Enterprise Security",
			"Responsive Design"
		]
	},
	strategic: {
		priorities: [
			"Research Excellence",
			"Knowledge Translation",
			"Policy Engagement"
		],
		domains: [
			"Alignment & Intent Engineering",
			"Fairness & Representational Integrity",
			"Interdisciplinary Integration",
			"Interpretability & Transparency",
			"Adversarial Resilience",
			"Capability Mapping",
			"Robustness Engineering"
		]
	},
	endpoints: {
		viz: "/api/research/visualization-data/:category",
		network: "/api/research/network-topology",
		trends: "/api/analytics/research-trends?category=...&timeframe=...",
		health: "/health"
	}
};

// Stops for fly-through (approx Houston districts/landmarks)
const STOPS = [
	{ key: 1, id: "downtown", name: "Downtown", theme: "City Core • Research HQ", color: 0x7aa7ff, pos: new THREE.Vector3(0, 26, 110), lookAt: new THREE.Vector3(0, 0, 0) },
	{ key: 2, id: "med", name: "Texas Medical Center", theme: "Fairness & Bioethics", color: 0x1df2ff, pos: new THREE.Vector3(-110, 24, 30), lookAt: new THREE.Vector3(-30, 0, 0) },
	{ key: 3, id: "energy", name: "Energy Corridor", theme: "Resilience & Infrastructure", color: 0xffd166, pos: new THREE.Vector3(120, 22, -20), lookAt: new THREE.Vector3(30, 0, -20) },
	{ key: 4, id: "space", name: "Space Center", theme: "Capability Mapping", color: 0xb28dff, pos: new THREE.Vector3(40, 36, 150), lookAt: new THREE.Vector3(20, 0, 80) },
	{ key: 5, id: "museum", name: "Museum District", theme: "Interpretability & Transparency", color: 0x9ff9ff, pos: new THREE.Vector3(-70, 18, -100), lookAt: new THREE.Vector3(-20, 0, -40) },
	{ key: 6, id: "port", name: "Port of Houston", theme: "Adversarial Resilience", color: 0x66ffd2, pos: new THREE.Vector3(150, 18, 90), lookAt: new THREE.Vector3(80, 0, 30) }
];

function initScene() {
	STATE.scene = new THREE.Scene();
	STATE.scene.fog = new THREE.FogExp2(0x071425, 0.008);

	STATE.camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1500);
	STATE.camera.position.set(0, 28, 220);

	STATE.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, powerPreference: 'high-performance' });
	STATE.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
	STATE.renderer.setSize(window.innerWidth, window.innerHeight);
	STATE.renderer.shadowMap.enabled = true;
	document.body.appendChild(STATE.renderer.domElement);

	STATE.controls = new THREE.OrbitControls(STATE.camera, STATE.renderer.domElement);
	STATE.controls.enableDamping = true;
	STATE.controls.dampingFactor = 0.06;
	STATE.controls.enablePan = false;
	STATE.controls.minDistance = 10;
	STATE.controls.maxDistance = 500;

	const ambient = new THREE.AmbientLight(0x6fa6ff, .45);
	STATE.scene.add(ambient);
	const sun = new THREE.DirectionalLight(0xffffff, 1.0);
	sun.position.set(120, 220, 160);
	sun.castShadow = true;
	sun.shadow.mapSize.set(2048, 2048);
	STATE.scene.add(sun);

	const hemi = new THREE.HemisphereLight(0x88bbff, 0x091120, .55);
	STATE.scene.add(hemi);

	// Post FX
	const composer = new THREE.EffectComposer(STATE.renderer);
	const renderPass = new THREE.RenderPass(STATE.scene, STATE.camera);
	const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 0.75, 0.4, 0.85);
	composer.addPass(renderPass);
	composer.addPass(bloomPass);
	STATE.composer = composer; STATE.bloomPass = bloomPass;

	buildGround();
	buildSky();
	buildCity();
	buildEnergy();
	buildNetworkBeacons();
	buildPOIs();

	STATE.panelEl = document.getElementById('panel');
	STATE.navEl = document.getElementById('nav');
	STATE.tooltipEl = document.getElementById('tooltip');
	STATE.toastEl = document.getElementById('toast');
	setupNav();
	setTimeout(()=> STATE.toastEl.classList.add('show'), 700);

	window.addEventListener('resize', onResize);
	window.addEventListener('mousemove', onMouseMove);
	window.addEventListener('click', onClick);
	window.addEventListener('keydown', onKey);

	selectStop('downtown');
	animate();
}

function buildGround() {
	const geo = new THREE.CylinderGeometry(450, 480, 2, 96, 1, true);
	const mat = new THREE.MeshStandardMaterial({ color: 0x0b243f, metalness: .2, roughness: .9, side: THREE.DoubleSide });
	const ring = new THREE.Mesh(geo, mat);
	ring.rotation.x = Math.PI/2; ring.position.y = -1;
	STATE.scene.add(ring);

	const grid = new THREE.GridHelper(900, 90, 0x0b6bea, 0x0a3a6f);
	grid.position.y = 0; grid.material.opacity = .12; grid.material.transparent = true;
	STATE.scene.add(grid);
}

function buildSky() {
	const stars = new THREE.Points(
		new THREE.BufferGeometry(),
		new THREE.PointsMaterial({ color: 0x7aa7ff, size: 1.6, sizeAttenuation: true, transparent: true, opacity: .7 })
	);
	const count = 4000; const positions = new Float32Array(count * 3);
	for (let i=0;i<count;i++){ const r=THREE.MathUtils.randFloat(240, 1200); const a=Math.random()*Math.PI*2; const h=THREE.MathUtils.randFloat(-120, 280); positions[i*3]=Math.cos(a)*r; positions[i*3+1]=h; positions[i*3+2]=Math.sin(a)*r; }
	stars.geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
	STATE.scene.add(stars);
}

function box(w,h,d,c){ const g=new THREE.BoxGeometry(w,h,d); const m=new THREE.MeshStandardMaterial({ color:c, roughness:.6, metalness:.15 }); const b=new THREE.Mesh(g,m); b.castShadow = true; b.receiveShadow = true; return b; }
function cylinder(r1,r2,h,c){ const g=new THREE.CylinderGeometry(r1,r2,h,24); const m=new THREE.MeshStandardMaterial({ color:c, roughness:.5, metalness:.3 }); const t=new THREE.Mesh(g,m); t.castShadow=t.receiveShadow=true; return t; }

function buildCity(){
	const group = new THREE.Group();
	const seed = Math.random()*9999;
	for (let i=0;i<240;i++){
		const x = THREE.MathUtils.randFloatSpread(400);
		const z = THREE.MathUtils.randFloatSpread(400);
		const dist = Math.hypot(x,z);
		if (dist < 30) continue; // central plaza
		const h = THREE.MathUtils.mapLinear(Math.random(), 0, 1, 4, 42) * Math.exp(-dist/380);
		const b = box(THREE.MathUtils.randFloat(6,12), h, THREE.MathUtils.randFloat(6,12), 0x143b66);
		b.position.set(x, h/2, z);
		group.add(b);
		if (Math.random()>.7){ const ant = cylinder(0.3,0.3, THREE.MathUtils.randFloat(2,6), 0x1df2ff); ant.position.set(x, h+1, z); group.add(ant); }
	}
	// central campus
	const hq = box(40, 16, 40, 0x1a4d84); hq.position.set(0, 8, 0); group.add(hq);
	const atr = cylinder(8,8, 6, 0x9ff9ff); atr.position.set(0, 14, 0); group.add(atr);
	STATE.scene.add(group);
}

function buildEnergy(){
	const group = new THREE.Group();
	for (let i=0;i<8;i++){ const t = cylinder(3,3, THREE.MathUtils.randFloat(18,26), 0x7a5a2b); t.position.set(90+ i*8, t.geometry.parameters.height/2, -40 + Math.sin(i)*8); group.add(t); }
	for (let i=0;i<16;i++){ const f = cylinder(0.5,2, 10, 0x888888); f.position.set(120+Math.cos(i)*10, 5, -20+Math.sin(i)*10); group.add(f); }
	const flare = new THREE.PointLight(0xffb45e, 2.0, 80); flare.position.set(140, 18, -18); group.add(flare);
	STATE.scene.add(group);
}

function buildNetworkBeacons(){
	const g = new THREE.SphereGeometry(1.2, 20, 20);
	const m = new THREE.MeshStandardMaterial({ color: 0x1df2ff, emissive: 0x0a5e77, emissiveIntensity: .8, metalness:.1, roughness:.3 });
	for (let i=0;i<28;i++){
		const s = new THREE.Mesh(g, m.clone());
		s.position.set(THREE.MathUtils.randFloatSpread(260), THREE.MathUtils.randFloat(2,36), THREE.MathUtils.randFloatSpread(260));
		s.material.color.offsetHSL(THREE.MathUtils.randFloat(-.04,.04), 0, 0);
		STATE.scene.add(s);
	}
}

function buildPOIs(){
	STOPS.forEach((stop)=>{
		const geom = new THREE.ConeGeometry(2.3, 7.5, 20);
		const mat = new THREE.MeshStandardMaterial({ color: stop.color, emissive: stop.color, emissiveIntensity: .25, metalness:.25, roughness:.4 });
		const mesh = new THREE.Mesh(geom, mat);
		mesh.position.copy(stop.lookAt.clone().multiplyScalar(.6));
		mesh.position.y = Math.max(4, mesh.position.y);
		mesh.rotation.x = -Math.PI/2;
		mesh.userData = { id: stop.id, name: stop.name, theme: stop.theme };
		STATE.scene.add(mesh);
		STATE.poiMeshes.push(mesh);
	});
}

function onResize(){
	STATE.camera.aspect = window.innerWidth / window.innerHeight;
	STATE.camera.updateProjectionMatrix();
	STATE.renderer.setSize(window.innerWidth, window.innerHeight);
	STATE.composer.setSize(window.innerWidth, window.innerHeight);
}

function onMouseMove(e){
	STATE.mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
	STATE.mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
	const tooltip = STATE.tooltipEl;
	tooltip.style.left = e.clientX + 'px';
	tooltip.style.top = e.clientY + 'px';

	STATE.raycaster.setFromCamera(STATE.mouse, STATE.camera);
	const it = STATE.raycaster.intersectObjects(STATE.poiMeshes, true);
	if (it.length){ const o = it[0].object; tooltip.style.display = 'block'; document.getElementById('tt1').textContent = o.userData.name; document.getElementById('tt2').textContent = o.userData.theme; }
	else { tooltip.style.display = 'none'; }
}

function onClick(e){
	STATE.raycaster.setFromCamera(STATE.mouse, STATE.camera);
	const it = STATE.raycaster.intersectObjects(STATE.poiMeshes, true);
	if (it.length){ const id = it[0].object.userData.id; selectStop(id); flyTo(id); showToast(`Flying to ${it[0].object.userData.name}`); }
}

function onKey(e){
	if (e.key === 'f' || e.key === 'F'){ toggleFullscreen(); }
	if (/^[1-6]$/.test(e.key)){ const idx = Number(e.key)-1; const id = STOPS[idx].id; selectStop(id); flyTo(id); showToast(`Flying to ${STOPS[idx].name}`); }
}

function toggleFullscreen(){ if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }

function animate(){
	requestAnimationFrame(animate);
	const t = STATE.clock.getElapsedTime();
	STATE.poiMeshes.forEach((m, i)=>{ m.position.y += Math.sin(t*1.2 + i)*0.01; m.rotation.z += 0.01; });
	STATE.controls.update();
	STATE.composer.render();
}

function flyTo(id){
	const stop = STOPS.find(s=>s.id===id); if (!stop) return;
	gsap.to(STATE.camera.position, { duration: 2.2, x: stop.pos.x, y: stop.pos.y, z: stop.pos.z, ease: 'power3.inOut' });
	gsap.to({}, { duration: 2.2, onUpdate: ()=> STATE.camera.lookAt(stop.lookAt.x, stop.lookAt.y, stop.lookAt.z) });
}

function setupNav(){
	STOPS.forEach(s=>{
		const b = document.createElement('button'); b.className='nav-btn'; b.textContent = `${s.key}. ${s.name}`; b.onclick = ()=>{ selectStop(s.id); flyTo(s.id); };
		STATE.navEl.appendChild(b);
	});
}

function selectStop(id){
	const s = STOPS.find(x=>x.id===id);
	if (!s) return;
	const metrics = mockMetricsForStop(s.id);
	STATE.panelEl.innerHTML = sectionForStop(s, metrics);
}

function mockMetricsForStop(id){
	const rnd = (a,b)=> (Math.random()*(b-a)+a);
	return {
		impact: rnd(72, 98).toFixed(1)+"",
		novelty: rnd(60, 95).toFixed(1)+"",
		collab: rnd(40, 92).toFixed(1)+"",
		network: rnd(35, 88).toFixed(1)+""
	};
}

function badge(txt){ return `<span class="badge">${txt}</span>`; }

function list(items){ return `<ul>${items.map(i=>`<li>${i}</li>`).join('')}</ul>`; }

function sectionForStop(stop, m){
	const sharedTop = `
		<h2>${stop.name}</h2>
		<div class="muted">${stop.theme}</div>
		<div class="metrics">
			<div class="metric"><div class="k">${m.impact}%</div><div class="l">Impact</div></div>
			<div class="metric"><div class="k">${m.novelty}%</div><div class="l">Novelty</div></div>
			<div class="metric"><div class="k">${m.collab}%</div><div class="l">Collaboration</div></div>
		</div>
	`;
	const arch = `${badge('C++ Core')} ${badge('Java Analytics')} ${badge('Node Realtime')} ${badge('WebGL 3D')}`;
	const endpoints = `
		<h3>Endpoints</h3>
		<ul>
			<li><code>${CONTENT.endpoints.viz}</code></li>
			<li><code>${CONTENT.endpoints.network}</code></li>
			<li><code>${CONTENT.endpoints.trends}</code></li>
			<li><code>${CONTENT.endpoints.health}</code></li>
		</ul>
	`;

	switch (stop.id){
		case 'downtown':
			return `
				${sharedTop}
				<h3>Vision</h3>
				<p>${CONTENT.brand.vision}</p>
				<h3>Signature Capabilities</h3>
				${list(CONTENT.brand.features)}
				<h3>Architecture</h3>
				<p>${arch}</p>
				${endpoints}
			`;
		case 'med':
			return `
				${sharedTop}
				<h3>Priority Area</h3>
				${list([CONTENT.strategic.domains[1], CONTENT.strategic.domains[2]])}
				<h3>Translation</h3>
				${list(['Research briefs for policymakers','Public-facing explanation platform','Practitioner toolkits'])}
				${endpoints}
			`;
		case 'energy':
			return `
				${sharedTop}
				<h3>Resilience Programs</h3>
				${list(['Adversarial red-teaming','Robustness invariance research','Safety-critical guarantees'])}
				<h3>Operations</h3>
				${list(['Realtime metrics streaming','Redis caching','Rate-limited APIs'])}
				${endpoints}
			`;
		case 'space':
			return `
				${sharedTop}
				<h3>Capability Mapping</h3>
				${list(['Taxonomies of model capabilities','Emergent ability exploration','Cross-model evals'])}
				<h3>Network Analysis</h3>
				${list(['Centrality scores','Interdisciplinary edges','Density diagnostics'])}
				${endpoints}
			`;
		case 'museum':
			return `
				${sharedTop}
				<h3>Interpretability</h3>
				${list(['Activation visualization','Latent knowledge extraction','Mechanistic explanations'])}
				<h3>Values</h3>
				${list(['Intellectual Integrity','Transparency','Inclusivity'])}
				${endpoints}
			`;
		case 'port':
			return `
				${sharedTop}
				<h3>Adversarial Resilience</h3>
				${list(['Synthetic content detection','Responsible disclosure','Defense efficacy assessments'])}
				<h3>Policy & Community</h3>
				${list(['Multi-stakeholder dialogue','Annual policy summit','Regulatory relationships'])}
				${endpoints}
			`;
		default:
			return `${sharedTop}`;
	}
}

function showToast(msg){ const t=STATE.toastEl; t.textContent = msg; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'), 2300); }

// Boot
initScene();
</script>
</body>
</html>
